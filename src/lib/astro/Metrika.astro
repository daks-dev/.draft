---
import { setup } from '$app/stores';
const { draft } = setup.get();

import app from '$app/configs/app';

const counter = app[draft]?.counter;
const options ={
    clickmap: true,
    trackLinks: true,
    accurateTrackBounce: true,
    trackHash: true
  }
---

{
  counter && (
    <script define:vars={{ counter, options }}>
      //@ts-nocheck
      const init = () => ym(counter, 'init', options);
      ((w, y) => {
        w[y] = (...rest) => (w[y].a = w[y].a || []).push(rest);
        w[y].l = Number(new Date());
      })(window, 'ym');
      const src = `https://mc.yandex.ru/metrika/tag.js`;
      if (!document.head.querySelector(`script[src="${src}"]`)) {
        const el = document.createElement('script');
        el.src = src;
        el.async = true;
        el.addEventListener('load', init, { once: true });
        document.head.appendChild(el);
     }
    </script>
  )
}
